<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Programa √Ångel</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#020617">

 <style>

.header {
  text-align: center;
  margin-bottom: 20px;
}

.header img {
  width: 90px;
  margin-bottom: 10px;
  filter: drop-shadow(0 0 12px rgba(34,197,94,0.6));
}

.header h1 {
  margin: 0;
  font-size: 22px;
}
   
:root {
  --bg: #020617;
  --card: #0f172a;
  --card-dark: #020617;
  --primary: #22c55e;
  --secondary: #38bdf8;
  --text: #e5e7eb;
  --muted: #94a3b8;
}

* {
  box-sizing: border-box;
}

body {
  font-family: 'Inter', system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  padding: 16px;
}

.box {
  max-width: 440px;
  margin: auto;
  background: var(--card);
  padding: 22px;
  border-radius: 18px;
  box-shadow: 0 15px 35px rgba(0,0,0,.4);
}

h1 {
  text-align: center;
  margin-bottom: 18px;
  font-size: 1.4rem;
}

input, textarea, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 12px;
  border: none;
  font-size: 15px;
  background: var(--card-dark);
  color: var(--text);
}

input::placeholder,
textarea::placeholder {
  color: var(--muted);
}

textarea {
  resize: vertical;
  min-height: 70px;
}

button {
  background: var(--primary);
  color: #052e16;
  font-weight: 700;
  cursor: pointer;
  transition: transform .05s, opacity .2s;
}

button:hover {
  opacity: .9;
}

button:active {
  transform: scale(.98);
}

.res {
  margin-top: 16px;
  background: var(--card-dark);
  padding: 14px;
  border-radius: 14px;
  font-size: 14px;
  line-height: 1.45;
}

.res b {
  color: var(--secondary);
}

small {
  color: var(--muted);
}

label {
  font-size: 14px;
  color: var(--text);
}

#filtros button {
  margin-top: 8px;
  background: #1e293b;
  color: var(--text);
}

#filtros button:hover {
  background: #334155;
}

#vista-hist textarea {
  background: #020617;
}

#vista-hist button {
  background: #ef4444;
  color: #fff;
  margin-top: 8px;
}

#vista-hist button:hover {
  background: #dc2626;
}
.logo-box {
  width: 120px;
  height: 120px;
  margin: 0 auto 20px auto;
  border-radius: 50%;
  background: radial-gradient(circle at top, #22c55e, #0f172a);
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 25px rgba(34,197,94,0.6);
}

.logo-box img {
  width: 70%;
  height: 70%;
  object-fit: contain;
  filter: drop-shadow(0 0 6px rgba(0,0,0,0.6));
}
   
</style>
</head>

<body>
  <div class="box">
<div class="header">
  <h1>Programa √Ångel</h1>
  <div class="logo-box">
<img src="icono.png" alt="Logo Programa √Ångel">
</div>
</div>

<div>
  <button onclick="mostrarVista('calc')">Calcular</button>
  <button onclick="mostrarVista('hist')">Historial</button>
</div>

<!-- VISTA CALCULADORA -->
<div id="vista-calc">
  <input type="text" id="loteria" placeholder="Loter√≠a (ej: Real)">
  <input type="date" id="fecha">
  <input type="number" id="numero" placeholder="N√∫mero (ej: 32)">
  <textarea id="comentario" placeholder="Comentario (opcional)"></textarea>

  <!-- CONFIGURACI√ìN -->
<div class="res">
  <b>Configuraci√≥n</b><br><br>

  <label>
    Decimales:
    <input type="number" id="decimales" value="13" min="1" max="20">
  </label><br><br>

  <label>
    Divisor:
    <input type="number" id="divisor" value="1220">
  </label>
</div>
  
  <!-- OPCIONES -->
<div class="res">
  <b>Opciones</b><br><br>

  <!-- Tipo de suma -->
  <label>
    <input type="checkbox" id="optEnteros">
    Sumar enteros + decimales
  </label><br><br>

  <!-- Guardar historial -->
  <label>
    <input type="checkbox" id="optGuardar" checked>
    Guardar historial
  </label><br><br>

  <!-- Comentarios -->
  <label>
    <input type="checkbox" id="optComentario" checked>
    Usar comentario
  </label>
</div>
  
  <button onclick="calcular()">Calcular</button>

  <div class="res" id="resultado"></div>
</div>

<!-- VISTA HISTORIAL -->
<div id="vista-hist" style="display:none">
  <div id="filtros"></div>
  <div id="historial"></div>
</div>

<script>
function mostrarVista(vista) {
  document.getElementById("vista-calc").style.display = vista === "calc" ? "block" : "none";
  document.getElementById("vista-hist").style.display = vista === "hist" ? "block" : "none";
  if (vista === "hist") renderHistorial();
}

// ---- HISTORIAL ----
function obtenerHistorial() {
  return JSON.parse(localStorage.getItem("historial_calculos") || "[]");
}

function guardarHistorial(registro) {
  let historial = obtenerHistorial();
  historial.push(registro);
  localStorage.setItem("historial_calculos", JSON.stringify(historial));
}

function borrarRegistro(index) {
  let historial = obtenerHistorial();
  if (!confirm("¬øSeguro que quieres borrar este registro?")) return;
  historial.splice(index, 1);
  localStorage.setItem("historial_calculos", JSON.stringify(historial));
  renderHistorial();
}

function editarComentario(index, nuevo) {
  let historial = obtenerHistorial();
  historial[index].comentario = nuevo;
  localStorage.setItem("historial_calculos", JSON.stringify(historial));
}

function renderHistorial(filtro = "Todas") {
  let historial = obtenerHistorial();
  let cont = document.getElementById("historial");
  let filtros = document.getElementById("filtros");

  cont.innerHTML = "";
  filtros.innerHTML = "";

  if (historial.length === 0) {
    cont.innerHTML = "<p>No hay registros.</p>";
    return;
  }

  let loterias = [...new Set(historial.map(h => h.loteria))];

  ["Todas", ...loterias].forEach(lot => {
    let b = document.createElement("button");
    b.textContent = lot;
    b.onclick = () => renderHistorial(lot);
    filtros.appendChild(b);
  });

  historial
    .filter(h => filtro === "Todas" || h.loteria === filtro)
    .forEach((h, i) => {
      cont.innerHTML += `
        <div class="res">
          <b>${h.loteria}</b> ‚Äì ${h.fecha}<br><br>
          <small>Modo: ${h.modoSuma}</small><br><br>
          
          ${h.numero} √∑ ${h.divisor} = ${h.res1}<br>
          Total = ${h.total1}<br><br>

          ${h.divisor} √∑ ${h.numero} = ${h.res2}<br>
          Total = ${h.total2}<br><br>

          Comentario:<br>
          <textarea onchange="editarComentario(${i}, this.value)">${h.comentario || ""}</textarea>
          <br>
          <button onclick="borrarRegistro(${i})">üóë Borrar</button>
        </div>
      `;
    });
}

// --- L√ìGICA ---
function sumarFecha(fecha) {
  return [...fecha].filter(c => c >= '0' && c <= '9')
    .reduce((a,b)=>a+Number(b),0);
}

function dividirYSumar(num, divisor=1220, decimales=13, incluirEnteros=false, invertido=false) {
  let resultado = invertido ? (num/divisor) : (divisor/num);
  let str = resultado.toFixed(decimales);

  let partes = str.split(".");
  let suma = 0;

  if (incluirEnteros) {
    suma += [...partes[0]].reduce((a,b)=>a+Number(b),0);
  }

  suma += [...partes[1]].reduce((a,b)=>a+Number(b),0);

  return {str, suma};
}

function calcular() {
  let fecha = document.getElementById("fecha").value;
  let numero = Number(document.getElementById("numero").value);
  let decimales = Number(document.getElementById("decimales").value) || 13;
let divisor = Number(document.getElementById("divisor").value) || 1220;
  let loteria = document.getElementById("loteria").value || "Sin nombre";
  let comentario = document.getElementById("comentario").value;
  let usarEnteros = document.getElementById("optEnteros").checked;
let guardar = document.getElementById("optGuardar").checked;
let usarComentario = document.getElementById("optComentario").checked;
if (!usarComentario) comentario = "";
  if (!fecha || !numero) {
    alert("Completa los campos");
    return;
  }

  let sumaFecha = sumarFecha(fecha);
  let r1 = dividirYSumar(numero, divisor, decimales, usarEnteros, true);
  let r2 = dividirYSumar(numero, divisor, decimales, usarEnteros, false);

  document.getElementById("resultado").innerHTML = `
  Fecha ‚Üí suma = ${sumaFecha}<br><br>

  Divisi√≥n: ${numero} √∑ ${divisor} = ${r1.str}<br>
  Suma d√≠gitos decimales = ${r1.suma}<br>
  Total = ${sumaFecha + r1.suma}<br><br>

  Divisi√≥n: ${divisor} √∑ ${numero} = ${r2.str}<br>
  Suma d√≠gitos decimales = ${r2.suma}<br>
  Total = ${sumaFecha + r2.suma}
`;

    if (guardar) {
    guardarHistorial({
      loteria,
      fecha,
      numero,
      divisor,
      decimales,
      sumaFecha,
      modoSuma: usarEnteros ? "Enteros + decimales" : "Solo decimales",
      res1: r1.str,
      suma1: r1.suma,
      total1: sumaFecha + r1.suma,
      res2: r2.str,
      suma2: r2.suma,
      total2: sumaFecha + r2.suma,
      comentario
    });
  }
} 
</script>
</body>
</html>
