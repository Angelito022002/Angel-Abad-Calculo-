<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Programa √Ångel</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icono.PNG">
<meta name="theme-color" content="#020617">

<style>
:root {
  --bg:#020617;
  --card:#0f172a;
  --primary:#22c55e;
  --secondary:#38bdf8;
  --text:#e5e7eb;
  --muted:#94a3b8;
}

*{box-sizing:border-box}

body{
  font-family:Inter,system-ui,sans-serif;
  background:radial-gradient(circle at top,#0f766e,#020617 55%);
  color:var(--text);
  padding:16px;
}

.box{
  max-width:440px;
  margin:auto;
  background:var(--card);
  padding:22px;
  border-radius:18px;
  box-shadow:0 15px 35px rgba(0,0,0,.4);
}

.header{text-align:center;margin-bottom:20px}

.logo-box{
  width:180px;height:180px;margin:0 auto 15px;
  border-radius:50%;
  background:radial-gradient(circle at top,#22c55e,#0f172a);
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 0 30px rgba(34,197,94,.7);
}

.logo-box img{
  width:180%;height:180%;object-fit:contain;
  filter:drop-shadow(0 0 12px rgba(0,0,0,.6));
}

input,textarea{
  width:100%;padding:14px;margin-top:10px;
  border-radius:14px;border:1px solid rgba(255,255,255,.06);
  background:rgba(15,23,42,.7);color:var(--text);
}

input:focus,textarea:focus{
  border-color:var(--primary);
  box-shadow:0 0 0 2px rgba(34,197,94,.25);
}

textarea{resize:vertical;min-height:70px}

button{
  background:linear-gradient(135deg,#22c55e,#38bdf8);
  color:#022c22;font-weight:800;
  padding:14px;border-radius:16px;
  cursor:pointer;margin-top:14px;
  box-shadow:0 0 25px rgba(34,197,94,.55);
}

button:active{transform:scale(.97)}

.res{
  margin-top:18px;
  background:rgba(2,6,23,.75);
  backdrop-filter:blur(10px);
  padding:16px;border-radius:18px;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.04),
             0 10px 30px rgba(0,0,0,.45);
}

.res b{color:var(--secondary)}
small{color:var(--muted)}

.tabs{
  display:flex;
  gap:10px;
  margin-bottom:10px;
}

.tabs button{
  flex:1;
  background:#1e293b;
  color:var(--text);
  box-shadow:none;
}

.tabs button.activo{
  background:linear-gradient(135deg,#22c55e,#38bdf8);
  color:#022c22;
  box-shadow:0 0 20px rgba(34,197,94,.6);
}

/* switches */
.switch-row{
  display:flex;justify-content:space-between;
  align-items:center;margin:14px 0;
}

.switch{position:relative;width:48px;height:26px}
.switch input{opacity:0}
.slider{
  position:absolute;inset:0;
  background:#2a2f45;border-radius:30px;
}
.slider:before{
  content:"";position:absolute;
  width:20px;height:20px;
  left:3px;top:3px;
  background:#fff;border-radius:50%;
  transition:.3s;
}
.switch input:checked+.slider{
  background:linear-gradient(135deg,#2cff9a,#18b4ff);
}
.switch input:checked+.slider:before{
  transform:translateX(22px);
}

#vista-calc,#vista-hist{
  animation:fade .2s ease;
}

@keyframes fade{
  from{opacity:0;transform:translateY(6px)}
  to{opacity:1;transform:none}
}

#vista-hist button{
  background:#ef4444;color:#fff;
}
</style>
</head>

<body>
<div class="box">

<div class="header">
  <h1>Programa √Ångel</h1>
  <div class="logo-box">
    <img src="icono.PNG">
  </div>
</div>

<div class="tabs">
  <button id="btnCalc" class="activo" onclick="mostrarVista('calc')">Calcular</button>
  <button id="btnHist" onclick="mostrarVista('hist')">Historial</button>
</div>

<!-- VISTA CALC -->
<div id="vista-calc">

<input id="loteria" placeholder="Loter√≠a">
<input type="date" id="fecha">
<input type="number" id="numero" placeholder="N√∫mero">
<textarea id="comentario" placeholder="Comentario"></textarea>

<div class="res">
<b>Configuraci√≥n</b><br><br>
Decimales <input type="number" id="decimales" value="13">
Divisor <input type="number" id="divisor" value="1220">
</div>

<div class="res">
<b>Opciones</b>

<div class="switch-row">
<span>Enteros + decimales</span>
<label class="switch">
<input type="checkbox" id="optEnteros">
<span class="slider"></span>
</label>
</div>

<div class="switch-row">
<span>Guardar historial</span>
<label class="switch">
<input type="checkbox" id="optGuardar" checked>
<span class="slider"></span>
</label>
</div>

<div class="switch-row">
<span>Usar comentario</span>
<label class="switch">
<input type="checkbox" id="optComentario" checked>
<span class="slider"></span>
</label>
</div>
</div>

<button onclick="calcular()">Calcular</button>
<div class="res" id="resultado"></div>
</div>

<!-- VISTA HIST -->
<div id="vista-hist" style="display:none">
<div id="filtros"></div>
<div id="historial"></div>
</div>

</div>

<script>
function mostrarVista(v){
  vistaCalc.style.display=v==="calc"?"block":"none";
  vistaHist.style.display=v==="hist"?"block":"none";
  btnCalc.classList.toggle("activo",v==="calc");
  btnHist.classList.toggle("activo",v==="hist");

  if(v==="hist"){
    historial.innerHTML="<p style='opacity:.6'>Cargando historial...</p>";
    setTimeout(renderHistorial,10);
  }
}

function obtenerHistorial(){
  return JSON.parse(localStorage.getItem("historial_calculos")||"[]");
}

function guardarHistorial(r){
  let h=obtenerHistorial();
  h.push(r);
  localStorage.setItem("historial_calculos",JSON.stringify(h));
}

function renderHistorial(f="Todas"){
  let h=obtenerHistorial(),html="";
  filtros.innerHTML="";
  if(!h.length){historial.innerHTML="No hay registros";return}

  ["Todas",...new Set(h.map(x=>x.loteria))].forEach(l=>{
    filtros.innerHTML+=`<button onclick="renderHistorial('${l}')">${l}</button>`
  });

  h.filter(x=>f==="Todas"||x.loteria===f).forEach((x,i)=>{
    html+=`
    <div class="res">
    <b>${x.loteria}</b> ‚Äì ${x.fecha}<br><br>
    ${x.res1} ‚Üí ${x.total1}<br>
    ${x.res2} ‚Üí ${x.total2}<br><br>
    <textarea onchange="editarComentario(${i},this.value)">${x.comentario||""}</textarea>
    <button onclick="borrarRegistro(${i})">üóë</button>
    </div>`
  });

  historial.innerHTML=html;
}

function borrarRegistro(i){
  let h=obtenerHistorial();
  h.splice(i,1);
  localStorage.setItem("historial_calculos",JSON.stringify(h));
  renderHistorial();
}

function editarComentario(i,v){
  let h=obtenerHistorial();
  h[i].comentario=v;
  localStorage.setItem("historial_calculos",JSON.stringify(h));
}

function sumarFecha(f){return [...f].filter(n=>/\d/.test(n)).reduce((a,b)=>a+ +b,0)}

function dividirYSumar(n,d,dec,ent,inv){
  let r=(inv?n/d:d/n).toFixed(dec).split(".");
  let s=(ent?[...r[0]]:[]).concat([...r[1]]).reduce((a,b)=>a+ +b,0);
  return {str:r.join("."),suma:s};
}

function calcular(){
  let f=fecha.value,n=+numero.value;
  if(!f||!n)return alert("Completa todo");

  let sf=sumarFecha(f),
  r1=dividirYSumar(n,divisor.value,decimales.value,optEnteros.checked,true),
  r2=dividirYSumar(n,divisor.value,decimales.value,optEnteros.checked,false);

  resultado.innerHTML=`Total1 ${sf+r1.suma}<br>Total2 ${sf+r2.suma}`;

  if(optGuardar.checked){
    guardarHistorial({
      loteria:loteria.value||"Sin nombre",
      fecha:f,res1:r1.str,res2:r2.str,
      total1:sf+r1.suma,total2:sf+r2.suma,
      comentario:optComentario.checked?comentario.value:""
    });
  }
}
</script>
</body>
</html>
